/**
 * videojs-tracking-events
 * @version 0.0.4
 * @copyright 2017 lribelle@tbxnet.com <lribelle@tbxnet.com>
 * @license UNLICENSED
 */
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):n.videojsTrackingEvents=e(n.videojs)}(this,function(n){"use strict";function e(n){return!!n&&"object"==typeof n}function t(n){var e=Object.prototype.toString.call(n);return"[object RegExp]"!==e&&"[object Date]"!==e}function r(n){return Array.isArray(n)?[]:{}}function o(n,e){return e&&!0===e.clone&&E(n)?a(r(n),n,e):n}function i(n,e,t){var r=n.slice();return e.forEach(function(e,i){void 0===r[i]?r[i]=o(e,t):E(e)?r[i]=a(n[i],e,t):-1===n.indexOf(e)&&r.push(o(e,t))}),r}function u(n,e,t){var r={};return E(n)&&Object.keys(n).forEach(function(e){r[e]=o(n[e],t)}),Object.keys(e).forEach(function(i){E(e[i])&&n[i]?r[i]=a(n[i],e[i],t):r[i]=o(e[i],t)}),r}function a(n,e,t){var r=Array.isArray(e),a=Array.isArray(n),c=t||{arrayMerge:i};return r===a?r?(c.arrayMerge||i)(n,e,t):u(n,e,t):o(e,t)}function c(n,e,t){var r={position:Math.round(e.currentTime()),timeSpent:Math.round((Date.now()-h)/1e3),event:n,contentId:t.contentId,profileId:t.profileId,drmType:e.drmType||null,formatType:e.currentSource().type};l(t.url,r,t.request)}function l(e,t,r){var o={body:JSON.stringify(t),url:e,method:"POST",headers:{"Content-Type":"application/json"}},i=T(r,o);n.xhr(i,function(n,e,t){})}function d(n){return n>=p.FIRSTQUARTILE&&!A.includes(I.FIRSTQUARTILE)?I.FIRSTQUARTILE:n>=p.MIDPOINT&&!A.includes(I.MIDPOINT)?I.MIDPOINT:n>=p.THIRDQUARTILE&&!A.includes(I.THIRDQUARTILE)?I.THIRDQUARTILE:n>=p.COMPLETE&&!A.includes(I.COMPLETE)?I.COMPLETE:n>=p.ENDED&&!A.includes(I.ENDED)?I.ENDED:null}function f(n){var e=[],t=null;do{(t=d(n))&&(e.push(t),A.push(t))}while(null!==t);return e}function s(n){A=A.filter(function(e){return n>p[e.toUpperCase()]})}n="default"in n?n.default:n;var E=function(n){return e(n)&&t(n)};a.all=function(n,e){if(!Array.isArray(n)||n.length<2)throw new Error("first argument should be an array with at least two elements");return n.reduce(function(n,t){return a(n,t,e)})};var T=a,I={LOAD:"Load",START:"Start",PROGRESS:"Progress",FIRSTQUARTILE:"FirstQuartile",MIDPOINT:"Midpoint",THIRDQUARTILE:"ThirdQuartile",COMPLETE:"Complete",PAUSE:"Pause",RESUME:"Resume",CLOSE:"Close",ENDED:"Ended"},p={FIRSTQUARTILE:25,MIDPOINT:50,THIRDQUARTILE:75,COMPLETE:95,ENDED:100},R={url:"http://localhost:9999",contentId:"content1234",profileId:"prof1234",request:{headers:{Authorization:"JWT 1234"}}},y=0,h=null,A=[],D=function(n,e){c(I.START,n,e)},O=function(n,e){c(I.PAUSE,n,e)},S=function(n,e){c(I.RESUME,n,e)},v=function(n,e){c(I.CLOSE,n,e)},L=function(n,e){var t=Math.round(n.currentTime()/n.duration()*100);y>n.currentTime()&&s(t);var r=f(t);r&&r.length>0&&c(r,n,e),y=n.currentTime()},m=function(n,e){n.on("loadedmetadata",D.bind(null,n,e)),n.on("timeupdate",L.bind(null,n,e)),n.on("pause",O.bind(null,n,e)),n.on("play",S.bind(null,n,e)),window.addEventListener("beforeunload",v.bind(null,n,e))},M=function(e){var t=this;this.ready(function(){h=Date.now(),m(t,n.mergeOptions(R,e))})};return(n.registerPlugin||n.plugin)("trackingEvents",M),M.VERSION="0.0.4",M});